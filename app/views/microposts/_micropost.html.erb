<li id="micropost-<%= micropost.id %>">
  <%= link_to gravatar_for(micropost.user, size: 50), micropost.user %>
  <span class="user"><%= link_to micropost.user.name, micropost.user %></span>
  <span class="content">
    <%= micropost.content %>
    <%= image_tag micropost.picture.url if micropost.picture? %>
  </span>
  <span class="timestamp">
    Posted <%= time_ago_in_words(micropost.created_at) %> ago.
    <% if current_user?(micropost.user) %>
      <%= link_to "delete", micropost, method: :delete,
                                       data: { confirm: "You sure?" } %>
    <% end %>
    
    <div id="like_form">
      <% if micropost.liking?(current_user) %>
        <%= form_for(micropost.likes.find_by(user_id: current_user.id),
                                                    html: { method: :delete }) do |f| %>
          <div><%= hidden_field_tag :micropost_id, micropost.id %></div>
          <%= f.submit "Unlike", class: "btn" %>
        <% end %>
      <% else %>
        <%= form_for(micropost.likes.build) do |f| %>
          <div><%= hidden_field_tag :micropost_id, micropost.id %></div>
          <%= f.submit "Like", class: "btn btn-primary" %>
        <% end %>
      <% end %>
    </div>

    <% micropost ||= current_micropost %>
    <div class="lkstats">
      <a href="<%= likes_path(micropost) %>">
        <strong id="liked" class="lkstat">
          <%= micropost.likes.count %>
        </strong>
        Liked
      </a>
    </div>
  </span>
</li>